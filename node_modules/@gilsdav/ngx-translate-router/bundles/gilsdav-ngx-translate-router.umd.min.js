!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ngx-translate/core"),require("rxjs"),require("@angular/common"),require("@angular/router"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@gilsdav/ngx-translate-router",["exports","@angular/core","@ngx-translate/core","rxjs","@angular/common","@angular/router","rxjs/operators"],t):t((e.gilsdav=e.gilsdav||{},e.gilsdav["ngx-translate-router"]={}),e.ng.core,null,e.rxjs,e.ng.common,e.ng.router,e.rxjs.operators)}(this,function(a,n,t,o,i,s,r){"use strict";var u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function c(e,t){function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(n=a.next()).done;)i.push(n.value)}catch(s){o={error:s}}finally{try{n&&!n.done&&(r=a["return"])&&r.call(a)}finally{if(o)throw o.error}}return i}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(l(arguments[t]));return e}var e,p=new n.InjectionToken("LOCALIZE_ROUTER_FORROOT_GUARD"),f=new n.InjectionToken("RAW_ROUTES");(e=a.CacheMechanism||(a.CacheMechanism={})).LocalStorage="LocalStorage",e.Cookie="Cookie";var d=new n.InjectionToken("USE_CACHED_LANG"),g=new n.InjectionToken("CACHE_MECHANISM"),y=new n.InjectionToken("CACHE_NAME"),v=new n.InjectionToken("DEFAULT_LANG_FUNCTION"),R=new n.InjectionToken("ALWAYS_SET_PREFIX"),L=function(){function e(e,t,r,n,o){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=a.CacheMechanism.LocalStorage),void 0===n&&(n="LOCALIZE_DEFAULT_LANGUAGE"),void 0===o&&(o=void 0),this.useCachedLang=e,this.alwaysSetPrefix=t,this.cacheMechanism=r,this.cacheName=n,this.defaultLangFunction=o}return e.ctorParameters=function(){return[{type:Boolean,decorators:[{type:n.Inject,args:[d]}]},{type:Boolean,decorators:[{type:n.Inject,args:[R]}]},{type:a.CacheMechanism,decorators:[{type:n.Inject,args:[g]}]},{type:String,decorators:[{type:n.Inject,args:[y]}]},{type:undefined,decorators:[{type:n.Inject,args:[v]}]}]},e}(),_=function(){function e(e,t,r){this.translate=e,this.location=t,this.settings=r}return e.prototype.init=function(e){var t;if(this.routes=e,!this.locales||!this.locales.length)return Promise.resolve();var r=this.getLocationLang(),n=this._getBrowserLang();this.settings.defaultLangFunction?this.defaultLang=this.settings.defaultLangFunction(this.locales,this._cachedLang,n):this.defaultLang=this._cachedLang||n||this.locales[0],t=r||this.defaultLang,this.translate.setDefaultLang(this.defaultLang);var o=[];if(this.settings.alwaysSetPrefix){var a={path:"",redirectTo:this.defaultLang,pathMatch:"full"},i=e.findIndex(function(e){return"**"===e.path});-1!==i&&(this._wildcardRoute=e.splice(i,1)[0]),o=this.routes.splice(0,this.routes.length,a)}else o=h(this.routes);for(var s=o.length-1;0<=s;s--)o[s].data&&o[s].data.skipRouteLocalization&&(this.settings.alwaysSetPrefix&&this.routes.push(o[s]),o.splice(s,1));return o&&o.length&&(1<this.locales.length||this.settings.alwaysSetPrefix)&&(this._languageRoute={children:o},this.routes.unshift(this._languageRoute)),this._wildcardRoute&&this.settings.alwaysSetPrefix&&this.routes.push(this._wildcardRoute),this.translateRoutes(t).toPromise()},e.prototype.initChildRoutes=function(e){return this._translateRouteTree(e),e},e.prototype.translateRoutes=function(r){var n=this;return new o.Observable(function(t){n._cachedLang=r,n._languageRoute&&(n._languageRoute.path=r),n.translate.use(r).subscribe(function(e){n._translationObject=e,n.currentLang=r,n._languageRoute?(n._languageRoute&&n._translateRouteTree(n._languageRoute.children),n._wildcardRoute&&n._wildcardRoute.redirectTo&&n._translateProperty(n._wildcardRoute,"redirectTo",!0)):n._translateRouteTree(n.routes),t.next(void 0),t.complete()})})},e.prototype._translateRouteTree=function(e){var t=this;e.forEach(function(e){null!==e.path&&e.path!==undefined&&t._translateProperty(e,"path"),e.redirectTo&&t._translateProperty(e,"redirectTo",!e.redirectTo.indexOf("/")),e.children&&t._translateRouteTree(e.children),e.loadChildren&&e._loadedConfig&&t._translateRouteTree(e._loadedConfig.routes)})},e.prototype._translateProperty=function(e,t,r){var n=e.data=e.data||{};n.localizeRouter||(n.localizeRouter={}),n.localizeRouter[t]||(n.localizeRouter[t]=e[t]);var o=this.translateRoute(n.localizeRouter[t]);e[t]=r?"/"+this.urlPrefix+o:o},Object.defineProperty(e.prototype,"urlPrefix",{get:function(){return this.settings.alwaysSetPrefix||this.currentLang!==this.defaultLang?this.currentLang:""},enumerable:!0,configurable:!0}),e.prototype.translateRoute=function(e){var t=this,r=e.split("?");if(2<r.length)throw Error("There should be only one query parameter block in the URL");return r[0].split("/").map(function(e){return e.length?t.translateText(e):e}).join("/")+(1<r.length?"?"+r[1]:"")},e.prototype.getLocationLang=function(e){var t=(e||this.location.path()).split("?"),r=[];return 0<t.length&&(r=t[0].split("/")),1<r.length&&-1!==this.locales.indexOf(r[1])?r[1]:r.length&&-1!==this.locales.indexOf(r[0])?r[0]:null},e.prototype._getBrowserLang=function(){return this._returnIfInLocales(this.translate.getBrowserLang())},Object.defineProperty(e.prototype,"_cachedLang",{get:function(){if(this.settings.useCachedLang)return this.settings.cacheMechanism===a.CacheMechanism.LocalStorage?this._cacheWithLocalStorage():this.settings.cacheMechanism===a.CacheMechanism.Cookie?this._cacheWithCookies():void 0},set:function(e){this.settings.useCachedLang&&(this.settings.cacheMechanism===a.CacheMechanism.LocalStorage&&this._cacheWithLocalStorage(e),this.settings.cacheMechanism===a.CacheMechanism.Cookie&&this._cacheWithCookies(e))},enumerable:!0,configurable:!0}),e.prototype._cacheWithLocalStorage=function(e){if("undefined"!=typeof window&&"undefined"!=typeof window.localStorage)try{return e?void window.localStorage.setItem(this.settings.cacheName,e):this._returnIfInLocales(window.localStorage.getItem(this.settings.cacheName))}catch(t){return}},e.prototype._cacheWithCookies=function(e){if("undefined"!=typeof document&&"undefined"!=typeof document.cookie)try{var t=encodeURIComponent(this.settings.cacheName);if(e){var r=new Date;return r.setTime(r.getTime()+2592e6),void(document.cookie=t+"="+encodeURIComponent(e)+";expires="+r.toUTCString())}var n=new RegExp("(?:^"+t+"|;\\s*"+t+")=(.*?)(?:;|$)","g").exec(document.cookie);return decodeURIComponent(n[1])}catch(o){return}},e.prototype._returnIfInLocales=function(e){return e&&-1!==this.locales.indexOf(e)?e:null},e.prototype.translateText=function(e){if(!this._translationObject)return e;var t=this.prefix+e,r=this.translate.getParsedResult(this._translationObject,t);return r!==t?r:e},e.ctorParameters=function(){return[{type:t.TranslateService,decorators:[{type:n.Inject,args:[t.TranslateService]}]},{type:i.Location,decorators:[{type:n.Inject,args:[i.Location]}]},{type:L,decorators:[{type:n.Inject,args:[L]}]}]},e}(),m=function(i){function e(e,t,r,n,o){void 0===n&&(n=["en"]),void 0===o&&(o="ROUTES.");var a=i.call(this,e,t,r)||this;return a.locales=n,a.prefix=o||"",a}return c(e,i),e.prototype.load=function(t){var r=this;return new Promise(function(e){r.init(t).then(e)})},e}(_),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return c(t,e),t.prototype.load=function(t){var r=this;return new Promise(function(e){r.init(t).then(e)})},t}(_),I=function(){function e(e,t,r,n){this.parser=e,this.settings=t,this.router=r,this.route=n,this.routerEvents=new o.Subject}return e.prototype.init=function(){this.router.resetConfig(this.parser.routes),this.router.events.pipe(r.filter(function(e){return e instanceof s.NavigationStart}),r.pairwise()).subscribe(this._routeChanged())},e.prototype.changeLanguage=function(e,a,i){var s=this;if(e!==this.parser.currentLang){var u=this.router.routerState.snapshot.root;this.parser.translateRoutes(e).subscribe(function(){var e=s.traverseRouteSnapshot(u);if(e=s.translateRoute(e),!s.settings.alwaysSetPrefix){var t=e.split("/"),r=t.indexOf(s.parser.currentLang);if(s.parser.currentLang===s.parser.defaultLang)(0===r||1===r&&""===t[0])&&(t=t.slice(0,r).concat(t.slice(r+1)));else if(-1===r){var n=""===t[0]?1:0;t=t.slice(0,n).concat(s.parser.currentLang,t.slice(n))}e=t.join("/")}var o=e.lastIndexOf("/");0<o&&o===e.length-1&&(e=e.slice(0,-1)),s.router.resetConfig(s.parser.routes),i?s.router.navigate([e],a):s.router.navigateByUrl(e,a)})}},e.prototype.traverseRouteSnapshot=function(e){return e.firstChild&&e.routeConfig?this.parseSegmentValue(e)+"/"+this.traverseRouteSnapshot(e.firstChild):e.firstChild?this.traverseRouteSnapshot(e.firstChild):this.parseSegmentValue(e)},e.prototype.parseSegmentValue=function(r){return r.data.localizeRouter?r.data.localizeRouter.path.split("/").map(function(e,t){return 0===e.indexOf(":")?r.url[t].path:e}).join("/"):""},e.prototype.translateRoute=function(e){var n=this;if("string"==typeof e){var t=this.parser.translateRoute(e);return e.indexOf("/")?t:"/"+this.parser.urlPrefix+t}var o=[];return e.forEach(function(e,t){if("string"==typeof e){var r=n.parser.translateRoute(e);t||e.indexOf("/")?o.push(r):o.push("/"+n.parser.urlPrefix+r)}else o.push(e)}),o},e.prototype._routeChanged=function(){var a=this;return function(e){var t=l(e,2),r=(t[0],t[1]),n=a.parser.currentLang,o=a.parser.getLocationLang(r.url)||a.parser.defaultLang;o!==n&&a.parser.translateRoutes(o).subscribe(function(){a.router.resetConfig(a.parser.routes),a.routerEvents.next(o)})}},e.ctorParameters=function(){return[{type:_,decorators:[{type:n.Inject,args:[_]}]},{type:L,decorators:[{type:n.Inject,args:[L]}]},{type:s.Router,decorators:[{type:n.Inject,args:[s.Router]}]},{type:s.ActivatedRoute,decorators:[{type:n.Inject,args:[s.ActivatedRoute]}]}]},e}();function S(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e!=e&&t!=t)return!0;var r,n,o,a=typeof e;if(a===typeof t&&"object"===a){if(!Array.isArray(e)){if(Array.isArray(t))return!1;for(n in o=Object.create(null),e)if(e.hasOwnProperty(n)){if(!S(e[n],t[n]))return!1;o[n]=!0}for(n in t)if(t.hasOwnProperty(n)&&!(n in o)&&"undefined"!=typeof t[n])return!1;return!0}if(!Array.isArray(t))return!1;if((r=e.length)===t.length){for(n=0;n<r;n++)if(!S(e[n],t[n]))return!1;return!0}}return!1}var w=function(){function e(e,t){var r=this;this.localize=e,this._ref=t,this.value="",this.subscription=this.localize.routerEvents.subscribe(function(){r.transform(r.lastKey)})}return e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe()},e.prototype.transform=function(e){return e&&0!==e.length&&this.localize.parser.currentLang?S(e,this.lastKey)&&S(this.lastLanguage,this.localize.parser.currentLang)?this.value:(this.lastKey=e,this.lastLanguage=this.localize.parser.currentLang,this.value=this.localize.translateRoute(e),this.lastKey=e,128&this._ref._view.state||this._ref.detectChanges(),this.value):e},e.decorators=[{type:n.Pipe,args:[{name:"localize",pure:!1}]}],e.ctorParameters=function(){return[{type:I},{type:n.ChangeDetectorRef}]},e}(),j=function(a){function e(e,t,r){var n=a.call(this,t,r)||this;return n.localize=e,n}return c(e,a),e.prototype.load=function(e){var o=this;return a.prototype.load.call(this,e).then(function(r){return{moduleType:r.moduleType,create:function(e){var t=r.create(e),n=t.injector.get.bind(t.injector);return t.injector.get=function(e,t){var r=n(e,t);return e===s.ROUTES?o.localize.initChildRoutes([].concat.apply([],h(r))):r},t}}})},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:_,decorators:[{type:n.Inject,args:[n.forwardRef(function(){return _})]}]},{type:n.Compiler},{type:n.SystemJsNgModuleLoaderConfig,decorators:[{type:n.Optional}]}]},e}(n.SystemJsNgModuleLoader),x=function(){function e(){}return e.prototype.shouldDetach=function(e){return!1},e.prototype.store=function(e,t){},e.prototype.shouldAttach=function(e){return!1},e.prototype.retrieve=function(e){return null},e.prototype.shouldReuseRoute=function(e,t){return!(!e||!t)&&this.getKey(e)===this.getKey(t)},e.prototype.getKey=function(e){return e.data.localizeRouter||e.parent&&e.parent.parent?e.data.localizeRouter?this.getKey(e.parent)+"/"+e.data.localizeRouter.path:void 0:"LANG"},e}(),T=function(){function e(e){this.injector=e}return e.prototype.appInitializer=function(){var e=this,t=this.parser.load(this.routes);return t.then(function(){e.injector.get(I).init()}),t},e.prototype.generateInitializer=function(e,t){return this.parser=e,this.routes=t.reduce(function(e,t){return e.concat(t)}),this.appInitializer},e.decorators=[{type:n.Injectable}],e.ctorParameters=function(){return[{type:n.Injector}]},e}();function A(e,t,r){return e.generateInitializer(t,r).bind(e)}var P=function(){function r(){}return r.forRoot=function(e,t){return void 0===t&&(t={}),{ngModule:r,providers:[{provide:p,useFactory:O,deps:[[r,new n.Optional,new n.SkipSelf]]},{provide:d,useValue:t.useCachedLang},{provide:R,useValue:t.alwaysSetPrefix},{provide:y,useValue:t.cacheName},{provide:g,useValue:t.cacheMechanism},{provide:v,useValue:t.defaultLangFunction},L,t.parser||{provide:_,useClass:C},{provide:f,multi:!0,useValue:e},I,T,{provide:n.NgModuleFactoryLoader,useClass:j},{provide:n.APP_INITIALIZER,multi:!0,useFactory:A,deps:[T,_,f]},{provide:s.RouteReuseStrategy,useClass:x}]}},r.forChild=function(e){return{ngModule:r,providers:[{provide:f,multi:!0,useValue:e}]}},r.decorators=[{type:n.NgModule,args:[{imports:[i.CommonModule,s.RouterModule,t.TranslateModule],declarations:[w],exports:[w]}]}],r}();function O(e){if(e)throw new Error("LocalizeRouterModule.forRoot() called twice. Lazy loaded modules should use LocalizeRouterModule.forChild() instead.");return"guarded"}a.ParserInitializer=T,a.getAppInitializer=A,a.LocalizeRouterModule=P,a.provideForRootGuard=O,a.LocalizeParser=_,a.ManualParserLoader=m,a.DummyLocalizeParser=C,a.LocalizeRouterService=I,a.LocalizeRouterPipe=w,a.LOCALIZE_ROUTER_FORROOT_GUARD=p,a.RAW_ROUTES=f,a.USE_CACHED_LANG=d,a.CACHE_MECHANISM=g,a.CACHE_NAME=y,a.DEFAULT_LANG_FUNCTION=v,a.ALWAYS_SET_PREFIX=R,a.LocalizeRouterSettings=L,a.LocalizeRouterConfigLoader=j,a.GilsdavReuseStrategy=x,Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=gilsdav-ngx-translate-router.umd.min.js.map